<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DJ Alamo ‚Äî Official App</title>
<link rel="manifest" href="manifest.json">

<style>
  :root{
    --bg1:#0c1c3a;
    --bg2:#050b18;
    --card:rgba(255,255,255,0.06);
    --text:#eaf1ff;
    --muted:rgba(234,241,255,0.72);
    --btn1:#3b82f6;
    --btn2:#2563eb;
    --stroke:rgba(255,255,255,0.10);
    --good:#22c55e;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    background:radial-gradient(circle at top, var(--bg1), var(--bg2));
    color:var(--text);
    font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    text-align:center;
    padding:18px 14px 22px;
    -webkit-text-size-adjust: 100%;
  }
  .wrap{ max-width:500px; margin:0 auto; }
  .card{
    background:var(--card);
    border:1px solid var(--stroke);
    border-radius:22px;
    padding:18px 16px 16px;
    box-shadow:0 18px 50px rgba(0,0,0,0.40);
    backdrop-filter: blur(10px);
  }
  .logo{
    width:min(240px, 82vw);
    height:auto;
    display:block;
    margin:2px auto 8px;
    border-radius:18px;
  }
  .title{
    margin:6px 0 4px;
    font-size:18px;
    font-weight:900;
    letter-spacing:0.2px;
  }
  .desc{
    margin:6px auto 14px;
    color:var(--muted);
    font-size:14px;
    line-height:1.35;
    max-width:420px;
  }

  .tabs{
    display:flex;
    gap:8px;
    justify-content:center;
    margin:12px 0 10px;
    flex-wrap:wrap;
  }
  .tabBtn{
    appearance:none;
    border:none;
    border-radius:999px;
    padding:10px 12px;
    font-size:13px;
    font-weight:800;
    color:rgba(234,241,255,0.88);
    background:rgba(0,0,0,0.18);
    border:1px solid rgba(255,255,255,0.10);
    cursor:pointer;
  }
  .tabBtn.active{
    color:#fff;
    background:linear-gradient(135deg,var(--btn1),var(--btn2));
    border-color:rgba(255,255,255,0.06);
    box-shadow:0 10px 28px rgba(59,130,246,0.25);
  }

  .section{ display:none; text-align:left; }
  .section.active{ display:block; }

  .row{ display:flex; flex-wrap:wrap; justify-content:center; gap:10px; }
  button.primary{
    appearance:none;
    border:none;
    border-radius:14px;
    padding:13px 14px;
    min-width:150px;
    font-size:15px;
    font-weight:900;
    color:white;
    background:linear-gradient(135deg,var(--btn1),var(--btn2));
    box-shadow:0 10px 28px rgba(59,130,246,0.35);
    cursor:pointer;
  }
  button.secondary{
    appearance:none;
    border-radius:14px;
    padding:13px 14px;
    min-width:150px;
    font-size:15px;
    font-weight:900;
    color:white;
    background:linear-gradient(135deg,#172554,#0b1220);
    box-shadow:none;
    border:1px solid rgba(255,255,255,0.10);
    cursor:pointer;
  }
  button:disabled{ opacity:0.45; cursor:not-allowed; }
  button:active{ transform:scale(0.98); }

  .playerCard{
    margin-top:10px;
    border:1px solid rgba(255,255,255,0.10);
    background:rgba(0,0,0,0.16);
    border-radius:18px;
    padding:12px;
  }
  .nowPlaying{
    display:flex;
    gap:10px;
    align-items:center;
  }
  .cover{
    width:56px; height:56px;
    border-radius:14px;
    background:rgba(255,255,255,0.06);
    border:1px solid rgba(255,255,255,0.10);
    overflow:hidden;
    flex:0 0 auto;
  }
  .cover img{ width:100%; height:100%; object-fit:cover; display:block; }
  .npText{ flex:1; min-width:0; }
  .npTitle{
    font-weight:900;
    font-size:14px;
    margin:0;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .npMeta{
    margin-top:2px;
    font-size:12px;
    color:rgba(234,241,255,0.70);
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  audio{
    width:100%;
    margin-top:10px;
    border-radius:14px;
  }

  .list{
    margin-top:12px;
    display:grid;
    gap:10px;
  }
  .track{
    display:flex;
    gap:10px;
    align-items:center;
    padding:12px;
    border-radius:18px;
    background:rgba(255,255,255,0.04);
    border:1px solid rgba(255,255,255,0.10);
    cursor:pointer;
    user-select:none;

    width:100%;
    min-width:0;
    overflow:hidden;
  }
  .track:active{ transform:scale(0.99); }
  .track .tCover{
    width:46px; height:46px;
    border-radius:14px;
    background:rgba(255,255,255,0.06);
    border:1px solid rgba(255,255,255,0.10);
    overflow:hidden;
    flex:0 0 auto;
    display:grid;
    place-items:center;
    color:rgba(234,241,255,0.70);
    font-weight:900;
    font-size:14px;
  }
  .track .tCover img{ width:100%; height:100%; object-fit:cover; display:block; }
  .track .tText{ flex:1; min-width:0; }
  .track .tTitle{
    font-weight:900;
    font-size:14px;
    margin:0;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .track .tSub{
    margin-top:2px;
    font-size:12px;
    color:rgba(234,241,255,0.70);
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .pill{
    font-size:11px;
    font-weight:900;
    padding:6px 8px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,0.10);
    background:rgba(0,0,0,0.18);
    color:rgba(234,241,255,0.82);
    flex:0 0 auto;
  }

  .adSlot{
    margin-top:12px;
    border-radius:18px;
    border:1px dashed rgba(255,255,255,0.22);
    background:rgba(0,0,0,0.14);
    padding:12px;
    text-align:center;
  }
  .adLabel{
    font-size:11px;
    font-weight:900;
    letter-spacing:0.6px;
    color:rgba(234,241,255,0.60);
    text-transform:uppercase;
    margin-bottom:8px;
  }
  .adInner{
    border-radius:14px;
    padding:12px;
    background:rgba(255,255,255,0.04);
    border:1px solid rgba(255,255,255,0.10);
    color:rgba(234,241,255,0.80);
    font-size:13px;
    line-height:1.3;
  }

  .status{
    margin-top:10px;
    color:rgba(234,241,255,0.72);
    font-size:13px;
    min-height:18px;
    text-align:center;
  }
  .mini{
    font-size:11px;
    color:rgba(234,241,255,0.55);
    text-align:center;
    margin-top:10px;
  }

  .badge{
    display:inline-flex;
    gap:6px;
    align-items:center;
    justify-content:center;
    font-size:12px;
    font-weight:900;
    padding:8px 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,0.10);
    background:rgba(0,0,0,0.18);
    color:rgba(234,241,255,0.82);
  }
  .dot{ width:8px; height:8px; border-radius:999px; background:var(--good); display:inline-block; }

  .noteBox{
    margin-top:10px;
    border-radius:16px;
    border:1px solid rgba(255,255,255,0.10);
    background:rgba(0,0,0,0.14);
    padding:12px;
    text-align:center;
    color:rgba(234,241,255,0.78);
    font-size:13px;
    line-height:1.35;
  }

  body::after{
    content:"";
    position:fixed;
    inset:0;
    pointer-events:none;
    background:
      radial-gradient(circle at center, transparent 58%, rgba(0,0,0,0.35)),
      repeating-linear-gradient(to bottom,
        rgba(255,255,255,0.02), rgba(255,255,255,0.02) 1px,
        transparent 2px, transparent 4px
      );
    mix-blend-mode:overlay;
  }
</style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <img src="dj-alamo.png" class="logo" alt="DJ Alamo logo" onerror="this.style.display='none';" />

      <div class="title">DJ Alamo</div>
      <div class="desc">
        Official app ‚Äî mixes, drops, and exclusives. No algorithm. Just the music.
      </div>

      <div class="row" style="margin-bottom:8px;">
        <div class="badge"><span class="dot"></span> Pilot ‚Ä¢ Powered by Base</div>
      </div>

      <div class="tabs">
        <button class="tabBtn active" data-tab="home">Home</button>
        <button class="tabBtn" data-tab="listen">Listen</button>
        <button class="tabBtn" data-tab="about">About</button>
      </div>

      <div id="tab-home" class="section active">
        <div class="row" style="margin-top:6px;">
          <button id="goListen" class="primary">‚ñ∂ Start Listening</button>
          <button id="goSite" class="secondary">üåê Visit DJAlamo.com</button>
          <button id="installBtn" class="secondary" style="display:none;">‚ûï Install App</button>
        </div>

        <div class="playerCard" style="margin-top:12px;">
          <div style="font-weight:900; font-size:14px; text-align:center;">What this is</div>
          <div style="margin-top:6px; color:rgba(234,241,255,0.72); font-size:13px; line-height:1.35; text-align:center;">
            This is DJ Alamo‚Äôs space. Fans come direct. Ads are optional and kept light.
          </div>
        </div>

        <div class="adSlot">
          <div class="adLabel">Ad</div>
          <div class="adInner">
            Pilot Ad Slot (Banner).<br/>
            Brand-safe only. No tracking of personal fan data.
          </div>
        </div>
      </div>

      <div id="tab-listen" class="section">
        <div class="playerCard">
          <div class="nowPlaying">
            <div class="cover">
              <img id="npCoverImg" src="" alt="" style="display:none;" />
              <div id="npCoverFallback" style="display:grid; place-items:center; width:100%; height:100%; font-weight:900; color:rgba(234,241,255,0.75);">DJ</div>
            </div>
            <div class="npText">
              <p class="npTitle" id="npTitle">Select a track</p>
              <div class="npMeta" id="npMeta">Ready.</div>
            </div>
            <span class="pill" id="npPill">V2</span>
          </div>

          <audio id="audio" controls preload="none"></audio>

          <div class="row" style="margin-top:10px;">
            <button id="prevBtn" class="secondary" disabled>‚èÆ Prev</button>
            <button id="nextBtn" class="primary" disabled>Next ‚è≠</button>
          </div>

          <div id="externalHint" class="noteBox" style="display:none;">
            This mix is hosted on LiveMixtapes.<br/>
            Tap <b>Open Mix</b> to listen.
            <div class="row" style="margin-top:10px;">
              <button id="openExternalBtn" class="primary">üîó Open Mix</button>
            </div>
          </div>
        </div>

        <div class="adSlot">
          <div class="adLabel">Ad</div>
          <div class="adInner">
            Pilot Banner Slot ‚Äî replace with sponsor image later.
          </div>
        </div>

        <div class="list" id="trackList" aria-label="Track list"></div>
      </div>

      <div id="tab-about" class="section">
        <div class="playerCard">
          <div style="font-weight:900; font-size:14px; text-align:center;">DJ Alamo</div>
          <div style="margin-top:6px; color:rgba(234,241,255,0.72); font-size:13px; line-height:1.35; text-align:center;">
            <b>You‚Äôre in one of the best DJ apps you can get.</b><br/>
            Built by Brooklyn-born DJ Alamo, whose career spans college tours, radio, and major live events across the East Coast. No algorithm ‚Äî just experience, timing, and real connection.
          </div>
          <div class="row" style="margin-top:10px;">
            <span class="pill">No algorithm</span>
            <span class="pill">Direct to fans</span>
            <span class="pill">Artist-owned feel</span>
          </div>
        </div>

        <div class="playerCard" style="margin-top:12px;">
          <div style="font-weight:900; font-size:14px; text-align:center;">Ads</div>
          <div style="margin-top:6px; color:rgba(234,241,255,0.72); font-size:13px; line-height:1.35; text-align:center;">
            Ads are optional. For this pilot we keep them light and brand-safe.
          </div>
        </div>
      </div>

      <div id="status" class="status">Ready.</div>
      <div class="mini">V2 Pilot ‚Ä¢ No fan accounts ‚Ä¢ No uploads</div>
    </div>
  </div>

<script>
const statusEl = document.getElementById('status');
const tabs = document.querySelectorAll('.tabBtn');
const sections = {
  home: document.getElementById('tab-home'),
  listen: document.getElementById('tab-listen'),
  about: document.getElementById('tab-about')
};

const goListenBtn = document.getElementById('goListen');
const goSiteBtn = document.getElementById('goSite');
const installBtn = document.getElementById('installBtn');

const audio = document.getElementById('audio');
const trackListEl = document.getElementById('trackList');
const npTitle = document.getElementById('npTitle');
const npMeta = document.getElementById('npMeta');
const npPill = document.getElementById('npPill');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');

const npCoverImg = document.getElementById('npCoverImg');
const npCoverFallback = document.getElementById('npCoverFallback');

const externalHint = document.getElementById('externalHint');
const openExternalBtn = document.getElementById('openExternalBtn');

let tracks = [];
let currentIndex = -1;
let deferredPrompt = null;
let currentExternalUrl = null;

function setStatus(t){ statusEl.textContent = t; }

/* Pilot 3 template fix: iOS PWA "return from external" repaint kick */
function forceRepaintKick(){
  try{
    const el = document.documentElement;
    el.style.webkitTransform = 'translateZ(0)';
    void el.offsetHeight;
    requestAnimationFrame(() => { el.style.webkitTransform = ''; });
  }catch(e){}
}
window.addEventListener('pageshow', forceRepaintKick);
window.addEventListener('focus', forceRepaintKick);
document.addEventListener('visibilitychange', () => {
  if(!document.hidden) forceRepaintKick();
});

function showTab(tab){
  tabs.forEach(b => b.classList.toggle('active', b.dataset.tab === tab));
  Object.keys(sections).forEach(k => sections[k].classList.toggle('active', k === tab));
}

tabs.forEach(btn => btn.addEventListener('click', () => showTab(btn.dataset.tab)));
goListenBtn.addEventListener('click', () => showTab('listen'));

/* NEW: Official site link (same-tab) */
goSiteBtn.addEventListener('click', () => {
  window.location.assign('https://djalamo.com');
});

prevBtn.addEventListener('click', () => {
  if(tracks.length < 1) return;
  const next = (currentIndex <= 0) ? tracks.length - 1 : currentIndex - 1;
  openIndex(next);
});
nextBtn.addEventListener('click', () => {
  if(tracks.length < 1) return;
  const next = (currentIndex >= tracks.length - 1) ? 0 : currentIndex + 1;
  openIndex(next);
});

audio.addEventListener('ended', () => {
  if(tracks.length > 1) nextBtn.click();
});

openExternalBtn.addEventListener('click', () => {
  if(!currentExternalUrl) return;
  window.location.assign(currentExternalUrl);
});

function escapeHtml(s){
  return String(s || '')
    .replaceAll('&','&amp;')
    .replaceAll('<','&lt;')
    .replaceAll('>','&gt;')
    .replaceAll('"','&quot;')
    .replaceAll("'","&#039;");
}

function renderTracks(){
  trackListEl.innerHTML = '';
  tracks.forEach((t, i) => {
    const item = document.createElement('div');
    item.className = 'track';
    item.setAttribute('role','button');
    item.setAttribute('tabindex','0');

    const isExternal = !!t.external;
    const coverHtml = t.cover
      ? `<img src="${escapeHtml(t.cover)}" alt="" />`
      : `<div style="display:grid;place-items:center;width:100%;height:100%;">${isExternal ? 'üîó' : '‚ñ∂'}</div>`;

    item.innerHTML = `
      <div class="tCover">${coverHtml}</div>
      <div class="tText">
        <p class="tTitle">${escapeHtml(t.title || 'Untitled')}</p>
        <div class="tSub">${escapeHtml(t.subtitle || (isExternal ? 'External link' : ''))}</div>
      </div>
      <span class="pill">${escapeHtml(t.tag || (isExternal ? 'Open' : 'Play'))}</span>
    `;

    item.addEventListener('click', () => openIndex(i));
    item.addEventListener('keydown', (e) => {
      if(e.key === 'Enter' || e.key === ' ') openIndex(i);
    });

    trackListEl.appendChild(item);
  });

  if(tracks.length){
    prevBtn.disabled = false;
    nextBtn.disabled = false;
    setStatus('Ready. Pick a mix.');
  }else{
    setStatus('No tracks found. Add tracks to content.json.');
  }
}

function resetPlayerForExternal(url){
  try{ audio.pause(); }catch(e){}
  audio.removeAttribute('src');
  audio.load();
  audio.style.display = 'none';

  currentExternalUrl = url || null;
  externalHint.style.display = 'block';
  npMeta.textContent = 'External mix (LiveMixtapes).';
  setStatus('Tap Open Mix.');
}

function resetPlayerForAudio(){
  externalHint.style.display = 'none';
  currentExternalUrl = null;
  audio.style.display = 'block';
}

function setNowPlaying(t){
  npTitle.textContent = t.title || 'Untitled';
  npMeta.textContent = t.subtitle || 'Ready.';
  npPill.textContent = (t.tag || 'V2');

  if(t.cover){
    npCoverImg.src = t.cover;
    npCoverImg.style.display = 'block';
    npCoverFallback.style.display = 'none';
  }else{
    npCoverImg.style.display = 'none';
    npCoverImg.src = '';
    npCoverFallback.style.display = 'grid';
  }
}

function openIndex(i){
  const t = tracks[i];
  if(!t) return;

  currentIndex = i;
  showTab('listen');
  setNowPlaying(t);

  if(!!t.external){
    resetPlayerForExternal(t.url);
    return;
  }

  resetPlayerForAudio();
  audio.src = t.url;

  audio.play().then(() => {
    setStatus('Playing.');
  }).catch(() => {
    setStatus('Tap play to start audio (browser policy).');
  });
}

async function loadContent(){
  try{
    setStatus('Loading‚Ä¶');
    const res = await fetch('content.json', { cache: 'no-store' });
    if(!res.ok) throw new Error('content.json not found');
    const json = await res.json();
    tracks = Array.isArray(json.tracks) ? json.tracks : [];
    renderTracks();
    setStatus('Ready.');
  }catch(err){
    console.error(err);
    setStatus('Could not load content.json. Make sure it exists in the same folder.');
  }
}

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  installBtn.style.display = 'inline-block';
});

installBtn.addEventListener('click', async () => {
  if(!deferredPrompt) return;
  deferredPrompt.prompt();
  try{ await deferredPrompt.userChoice; }catch(e){}
  deferredPrompt = null;
  installBtn.style.display = 'none';
});

if('serviceWorker' in navigator){
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./service-worker.js').catch(()=>{});
  });
}

showTab('home');
loadContent();
setStatus('Ready.');
</script>
</body>
</html>
